# 加载会话上下文

你是一个会话上下文管理助手。请加载指定的历史会话上下文，并**智能分析**上下文内容，为用户提供**可操作的后续建议**。

## 核心目标

> **不仅仅是展示内容，更要让用户能够无缝继续工作**

加载上下文后，你需要：
1. 完整展示上下文内容
2. 分析上下文中的待办事项、未完成任务
3. 提供具体的、可执行的后续操作建议
4. 让用户感受到"可以立即继续工作"

## 参数

`$ARGUMENTS` - 可以是：
- 数字序号（如 `1`、`2`）- 对应 /list-contexts 显示的序号
- 会话ID（UUID格式）
- 关键词（如 `git配置`）- 模糊匹配标题

## 执行步骤

### 步骤 1：查找会话

1. 读取 `~/.claude/conversations/index.json` 获取会话列表
2. 根据参数类型查找会话：
   - 如果是数字：按序号（从1开始）查找
   - 如果是UUID：按ID匹配
   - 如果是文本：在标题中模糊搜索
3. 如果找不到，显示错误信息和帮助提示

### 步骤 2：加载并展示内容

1. 读取对应的会话 Markdown 文件
2. 解析 YAML frontmatter 和正文内容
3. 以清晰的格式展示完整内容

### 步骤 3：智能分析（关键改进）

分析上下文内容，提取以下信息：

1. **待完成任务**：查找 `- [ ]` 标记的未完成任务
2. **进行中任务**：查找标记为"进行中"的任务
3. **下次继续指南**：查找 "下次继续" 或 "推荐下一步" 章节的内容
4. **关键文件**：提取涉及的核心文件路径
5. **会话类型**：分析/开发/调试/配置

### 步骤 4：生成后续建议

根据分析结果，生成**具体的、可执行的**后续操作建议：

- 如果有待完成任务 → 建议继续完成这些任务
- 如果有下次继续指南 → 提取并展示推荐操作
- 如果是分析型会话 → 建议基于分析结果采取行动
- 如果是开发型会话 → 建议继续开发或测试

## 输出格式

```
✅ 上下文已加载到当前对话

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 [会话标题]
📁 项目: [项目名] | 🕐 时间: [日期] | 🏷️ [标签列表]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 背景
[会话背景内容]

## 关键决策
[决策内容]

## 任务进度
[任务列表]

## 重要代码/命令
[代码内容]

## 注意事项
[注意事项]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎯 智能分析结果

📊 会话类型：[分析型/开发型/调试型/配置型]
📈 完成进度：[已完成 X 项 / 共 Y 项任务]

⏳ 待完成任务：
- [ ] 任务1
- [ ] 任务2

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🚀 推荐的后续操作

上下文已加载完成，我已理解之前的工作内容。你现在可以直接说：

💬 继续工作：
   • "继续完成 [待完成任务名称]"
   • "帮我实现 [下次继续指南中的建议]"

💬 深入分析：
   • "详细解释一下 [某个决策/概念]"
   • "分析一下 [某个文件] 的实现"

💬 扩展功能：
   • "基于这个分析，帮我 [具体操作]"
   • "优化 [某个模块] 的实现"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✨ 我已准备就绪，请告诉我你想要继续做什么？
```

## 针对不同会话类型的建议模板

### 分析型会话

```
🚀 推荐的后续操作（分析型）

基于已加载的架构分析，你可以：

💬 行动建议：
   • "帮我实现分析中提到的 P0 改进建议"
   • "针对 [评分较低的维度] 进行优化"
   • "生成一份改进计划文档"

💬 深入探索：
   • "详细分析 [某个模块] 的实现细节"
   • "对比 [当前方案] 和 [备选方案] 的优劣"
```

### 开发型会话

```
🚀 推荐的后续操作（开发型）

基于已加载的开发上下文，你可以：

💬 继续开发：
   • "继续实现 [未完成的功能]"
   • "为 [已实现的功能] 编写测试"
   • "优化 [某个模块] 的性能"

💬 代码相关：
   • "Review 一下已实现的代码"
   • "帮我重构 [某个文件]"
```

### 调试型会话

```
🚀 推荐的后续操作（调试型）

基于已加载的调试上下文，你可以：

💬 继续排查：
   • "按照排查思路继续调试"
   • "验证修复方案是否有效"
   • "检查是否有类似的问题"

💬 预防措施：
   • "帮我添加相关的测试用例"
   • "实现防御性代码避免类似问题"
```

### 配置型会话

```
🚀 推荐的后续操作（配置型）

基于已加载的配置上下文，你可以：

💬 继续配置：
   • "继续完成剩余的配置步骤"
   • "验证配置是否生效"
   • "帮我配置 [另一个环境]"

💬 文档化：
   • "生成配置文档"
   • "创建配置检查脚本"
```

## 错误处理

### 找不到会话

```
❌ 未找到匹配的会话

您输入的参数：$ARGUMENTS

可能的原因：
• 序号超出范围（当前共有 N 个会话）
• 关键词没有匹配到任何标题
• UUID 格式不正确或不存在

💡 解决方法：
• 使用 /list-contexts 查看所有保存的会话
• 使用 /search-context [关键词] 搜索会话
• 检查输入的参数是否正确
```

### 会话文件损坏

```
⚠️ 会话文件读取失败

文件路径：[文件路径]
错误原因：[具体错误]

💡 解决方法：
• 检查文件是否存在
• 检查文件格式是否正确
• 尝试手动修复或删除损坏的会话
```

## 重要提醒

1. **完整展示内容**：不要省略或截断上下文内容，用户需要看到完整信息
2. **智能分析**：主动分析待办事项和后续建议，不要只是被动展示
3. **可操作建议**：提供具体的、可以直接说出来的操作指令
4. **准备就绪**：明确告诉用户"我已准备好，可以继续工作"

现在开始执行加载操作！
