# 最佳实践

本文档介绍使用 Claude Context Manager 的最佳实践，帮助你更高效地管理会话上下文。

## 保存时机

### 推荐保存的场景

| 场景 | 重要性 | 说明 |
|------|--------|------|
| 完成功能开发 | 高 | 功能完成后立即保存，记录实现细节 |
| 完成架构设计 | 高 | 设计决策很重要，必须保存 |
| 解决复杂 Bug | 高 | 排查过程和解决方案值得记录 |
| 看到 "Conversation compacted" | 紧急 | 说明上下文即将被压缩，必须立即保存！ |
| 完成代码审查 | 中 | 审查意见和修改建议值得保存 |
| 完成技术调研 | 中 | 调研结论和对比分析应该保存 |
| 每日工作结束 | 中 | 养成每日保存的习惯 |

### 不需要保存的场景

| 场景 | 原因 |
|------|------|
| 简单问答 | 内容太少，没有保存价值 |
| 临时查询 | 一次性信息，无需持久化 |
| 测试命令 | 测试内容不需要记录 |

## 保存策略

### 分段保存

对于大型任务，建议分段保存：

```
┌─────────────────────────────────────────────────────────────────┐
│                     分段保存策略                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   阶段 1：需求分析                                               │
│      │                                                          │
│      ▼                                                          │
│   /save-context 需求分析完成  ← 保存点 1                         │
│      │                                                          │
│      ▼                                                          │
│   阶段 2：架构设计                                               │
│      │                                                          │
│      ▼                                                          │
│   /save-context 架构设计完成  ← 保存点 2                         │
│      │                                                          │
│      ▼                                                          │
│   阶段 3：核心功能开发                                           │
│      │                                                          │
│      ▼                                                          │
│   /save-context 核心功能完成  ← 保存点 3                         │
│      │                                                          │
│      ▼                                                          │
│   阶段 4：测试和优化                                             │
│      │                                                          │
│      ▼                                                          │
│   /save-context 全部完成     ← 保存点 4                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 好处

- 每个保存点都有完整的上下文
- 可以回溯到任意阶段
- 避免一次保存内容过多

## 标题命名

### 命名规范

使用清晰、描述性的标题：

**好的标题**：
- `用户认证模块开发 - JWT实现`
- `订单服务性能优化 - 缓存策略`
- `Bug修复 - 登录页面白屏问题`

**不好的标题**：
- `开发`
- `修复bug`
- `今天的工作`

### 命名模板

```
[项目/模块] + [任务类型] + [具体内容]
```

示例：
- `用户中心 - 功能开发 - 头像上传`
- `支付模块 - Bug修复 - 重复扣款`
- `数据库 - 架构设计 - 分库分表方案`

## 标签使用

### 标签类型

1. **技术栈标签**：`#Java`, `#React`, `#MySQL`
2. **任务类型标签**：`#feature`, `#bugfix`, `#refactor`
3. **项目标签**：`#projectA`, `#backend`
4. **状态标签**：`#completed`, `#inprogress`

### 标签数量

建议每个会话 3-8 个标签：
- 太少：不利于搜索
- 太多：失去重点

### 标签一致性

保持标签命名的一致性：

```
推荐：#authentication, #bugfix, #performance
避免：#auth, #authentication, #用户认证（同一概念多种写法）
```

## 内容组织

### 确保关键信息完整

每次保存时，确保包含以下信息：

```markdown
✅ 检查清单

□ 项目信息是否完整？
  - 项目名称
  - 项目路径
  - 相关文件列表

□ 需求描述是否清晰？
  - 用户原始需求
  - 需求分析和理解

□ 技术决策是否记录？
  - 选择的方案
  - 选择的原因
  - 放弃的方案

□ 代码修改是否记录？
  - 修改的文件
  - 关键代码片段
  - 修改原因

□ 任务进度是否更新？
  - 已完成的任务
  - 进行中的任务
  - 待办的任务

□ 问题和注意事项是否记录？
  - 遇到的问题
  - 解决方案
  - 潜在风险

□ 下一步建议是否明确？
  - 建议的操作
  - 优先级排序
```

### 代码记录

记录代码时，注意：

1. **只记录关键代码**：不是所有代码都需要保存
2. **添加注释说明**：解释代码的作用和原因
3. **记录文件路径**：方便后续定位

```markdown
### 关键代码

文件：`src/auth/JwtService.java`

```java
// JWT token 生成逻辑
// 使用 HS512 算法，有效期 24 小时
public String generateToken(User user) {
    return Jwts.builder()
        .setSubject(user.getId())
        .setExpiration(new Date(System.currentTimeMillis() + 86400000))
        .signWith(SignatureAlgorithm.HS512, secretKey)
        .compact();
}
```
```

## 恢复上下文

### 恢复前检查

加载历史上下文后，建议：

1. **快速浏览**：了解上次的工作内容
2. **检查进度**：确认已完成和待办的任务
3. **验证环境**：确保开发环境没有变化
4. **更新信息**：如有变化，先更新再继续

### 恢复后操作

```markdown
推荐的恢复流程：

1. /load-context <序号>
2. 阅读上下文摘要
3. 检查任务进度
4. 确认下一步操作
5. 开始工作
6. 工作完成后：/save-context（更新保存）
```

## 定期维护

### 清理旧会话

定期清理不再需要的会话：

```bash
# 每月清理一次
# 1. 查看所有会话
/list-contexts

# 2. 删除不需要的会话文件
rm ~/.claude/conversations/旧文件.md

# 3. 重建索引（运行 list-contexts 自动重建）
/list-contexts
```

### 归档重要会话

对于重要但不常用的会话，可以：

1. 创建归档目录
```bash
mkdir -p ~/.claude/conversations/archive
```

2. 移动旧文件
```bash
mv ~/.claude/conversations/2024-*.md ~/.claude/conversations/archive/
```

### 备份策略

```
备份建议：

频率：每周一次
内容：~/.claude/conversations/ 目录
位置：云存储或外部硬盘
保留：最近 3 个月的备份
```

## 团队协作

### 共享上下文

与团队成员共享上下文：

1. **导出文件**：复制 `.md` 文件
2. **共享方式**：邮件、即时通讯、共享文档
3. **导入方式**：将文件放入 `~/.claude/conversations/`

### 命名约定

团队使用时，建议统一命名约定：

```
[日期]_[成员]_[项目]_[任务].md

示例：
2025-12-24_张三_用户中心_登录功能.md
```

### 版本控制

可以将 conversations 目录纳入版本控制：

```bash
cd ~/.claude/conversations
git init
git add .
git commit -m "Initial commit"
```

## 常见问题预防

### 避免上下文丢失

1. **频繁保存**：完成重要步骤就保存
2. **注意提示**：看到 "compacted" 立即保存
3. **定期检查**：确认保存成功

### 避免保存失败

1. **检查磁盘空间**
2. **检查文件权限**
3. **检查文件名合法性**

### 避免信息遗漏

1. **使用检查清单**
2. **回顾后再保存**
3. **添加必要补充**

## 效率提升技巧

### 快捷操作

```
快速保存：/save-context（自动生成标题）
快速加载：/load-context 1（最近的会话）
快速搜索：/search-context #tag
```

### 工作流模板

```
日常开发工作流：

1. 开始工作
   /load-context（如果是继续之前的任务）

2. 工作中
   - 正常开发
   - 遇到重要节点就保存

3. 完成工作
   /save-context 今日工作总结

4. 下次继续
   /list-contexts
   /load-context 1
```

## 下一步

- 查看 [使用指南](./usage.md) 了解详细的命令用法
- 查看 [常见问题](./faq.md) 解决使用中的问题
