# 使用指南

本文档详细介绍 Claude Context Manager 的各项功能和使用方法。

## 命令总览

| 命令 | 用途 | 参数 |
|------|------|------|
| `/save-context` | 保存当前会话上下文 | `[标题]`（可选） |
| `/load-context` | 加载历史会话上下文 | `<序号>` 或 `<关键词>` |
| `/list-contexts` | 列出所有保存的会话 | 无 |
| `/search-context` | 搜索会话上下文 | `<搜索词>` |

## 保存上下文 `/save-context`

### 基本用法

```
/save-context
```

不带参数执行时，系统会自动根据会话内容生成标题。

### 指定标题

```
/save-context 用户认证功能开发
```

指定标题可以更方便地在后续查找和识别会话。

### 保存流程

执行保存命令后，系统会：

1. **分析会话类型**
   - 分析类（analysis）：主要进行代码分析、架构设计
   - 开发类（development）：主要进行功能开发
   - 调试类（debug）：主要进行 Bug 修复、问题排查
   - 配置类（config）：主要进行配置修改

2. **提取关键信息**
   - 用户需求描述
   - 技术决策和选择
   - 代码修改记录
   - 任务完成进度
   - 重要的注意事项

3. **生成标签**
   - 技术栈标签（如 `#Java`, `#React`）
   - 任务类型标签（如 `#feature`, `#bugfix`）
   - 项目标签

4. **质量检查**
   - 检查上下文完整性
   - 确保可恢复性
   - 验证关键信息是否被保存

5. **保存文件**
   - 生成 Markdown 文件
   - 更新索引 `index.json`

### 保存结果示例

```
✅ 会话上下文已保存！

📄 文件: 2025-12-24_143025_用户认证功能开发.md
📍 位置: ~/.claude/conversations/
🏷️ 标签: #authentication #JWT #Spring

质量检查: 8/8 项通过 ✓
```

## 列出会话 `/list-contexts`

### 用法

```
/list-contexts
```

### 输出示例

```
📚 保存的会话列表（共 5 个）

| 序号 | 日期时间              | 标题                    | 项目         | 标签              |
|------|-----------------------|-------------------------|--------------|-------------------|
| [1]  | 2025-12-24 16:30:45  | 用户认证功能开发         | my-project   | #auth #JWT        |
| [2]  | 2025-12-24 14:15:22  | API 接口设计             | my-project   | #api #design      |
| [3]  | 2025-12-24 10:08:33  | 数据库架构分析           | my-project   | #db #analysis     |
| [4]  | 2025-12-23 18:45:10  | Bug 修复记录             | other-proj   | #bug #fix         |
| [5]  | 2025-12-23 09:20:55  | 项目初始化               | other-proj   | #init #setup      |

💡 使用 /load-context <序号> 加载会话
💡 使用 /search-context <关键词> 搜索会话
```

### 输出说明

- **序号**：用于快速加载，数字越小越新
- **日期时间**：精确到秒的时间戳
- **标题**：会话的简短描述
- **项目**：关联的项目名称
- **标签**：自动生成的标签

## 加载上下文 `/load-context`

### 按序号加载

```
/load-context 1
```

加载列表中序号为 1 的会话。

### 按关键词加载

```
/load-context 认证
```

加载标题或标签中包含"认证"的会话。如果有多个匹配，会显示列表供选择。

### 加载后的效果

加载上下文后，Claude 会：

1. **显示完整上下文**
   - 项目信息
   - 之前的需求和决策
   - 代码修改历史
   - 任务进度

2. **提供智能建议**
   - 基于上下文推荐下一步操作
   - 提醒未完成的任务
   - 指出可能的问题

### 加载结果示例

```
✅ 已加载会话上下文

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 会话概述
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

项目: my-project
路径: /Users/dev/projects/my-project
日期: 2025-12-24 16:30:45
类型: 功能开发

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 用户需求
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

实现基于 JWT 的用户认证系统...

[完整上下文内容]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚀 建议继续操作
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

基于上次的进度，建议：
1. 完成 token 刷新接口
2. 添加登出功能
3. 编写单元测试
```

## 搜索上下文 `/search-context`

### 基本搜索

```
/search-context JWT
```

搜索所有包含 "JWT" 的会话。

### 标签搜索

```
/search-context #authentication
```

使用 `#` 前缀专门搜索标签。

### 搜索范围

搜索会检索以下内容：
- 会话标题
- 标签列表
- 一句话摘要
- 完整内容（可选）

### 搜索结果示例

```
🔍 搜索结果："JWT"（找到 2 个匹配）

| 序号 | 日期时间              | 标题                    | 匹配位置     |
|------|-----------------------|-------------------------|--------------|
| [1]  | 2025-12-24 16:30:45  | 用户认证功能开发         | 标题, 标签   |
| [2]  | 2025-12-22 11:20:33  | Token 刷新机制设计       | 内容         |

💡 使用 /load-context <序号> 加载会话
```

## 会话文件格式

每个保存的会话都是一个结构化的 Markdown 文件。

### 文件命名

```
YYYY-MM-DD_HHmmss_标题.md
```

示例：`2025-12-24_163045_用户认证功能开发.md`

### 文件结构

```markdown
---
id: "uuid-here"
title: "会话标题"
project: "项目名称"
project_path: "/path/to/project"
created_at: "2025-12-24T16:30:45+08:00"
updated_at: "2025-12-24T18:15:30+08:00"
tags: ["tag1", "tag2"]
summary: "一句话摘要"
type: "development"
---

# 会话上下文：会话标题

## 📋 会话概述
[项目信息、日期、类型等]

## 🎯 用户需求
[用户的原始需求描述]

## 📊 核心内容
[主要的技术内容、代码等]

## 💡 关键决策
[重要的技术决策和原因]

## ✅ 任务进度
[已完成、进行中、待办的任务]

## 💻 重要命令
[常用的命令和脚本]

## ⚠️ 注意事项
[需要注意的问题和风险]

## 🚀 下次继续指南
[建议的下一步操作]
```

## 使用场景示例

### 场景 1：功能开发中断

```
[开发过程中遇到 API 错误，需要重启]

1. 在当前窗口执行：/save-context 用户模块开发
2. 打开新的 Claude Code 窗口
3. 执行：/load-context 用户模块开发
4. 继续开发！
```

### 场景 2：跨天继续工作

```
[昨天开发到一半，今天继续]

1. 执行：/list-contexts
2. 找到昨天的会话
3. 执行：/load-context 1
4. 查看上下文，继续工作
```

### 场景 3：查找历史决策

```
[需要回顾之前为什么选择某个技术方案]

1. 执行：/search-context 技术选型
2. 或者：/search-context #architecture
3. 加载相关会话
4. 查看决策记录
```

### 场景 4：分享上下文给团队

```
[需要让同事了解项目背景]

1. 执行：/list-contexts
2. 找到相关会话
3. 将 ~/.claude/conversations/xxx.md 文件分享给同事
4. 同事可以阅读或导入
```

## 下一步

- 查看 [最佳实践](./best-practices.md) 了解如何高效使用
- 查看 [配置说明](./configuration.md) 了解自定义选项
- 查看 [常见问题](./faq.md) 解决使用中的问题
